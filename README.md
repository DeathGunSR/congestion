# Context-Aware Network Congestion Prediction using LSTM

This project uses a multi-input Long Short-Term Memory (LSTM) neural network to predict network congestion. It is "context-aware," meaning it understands the type of network activity (e.g., web browsing, file transfer) to make smarter predictions.

The system aggregates traffic data into 0.5-second intervals and uses a sequence of the last 5 seconds of data, along with the activity type, to predict congestion in the next second.

## Project Structure

- `data/`: A directory where you must place your labeled `.pcap` files for training.
- `feature_extractor.py`: A utility module that handles all the advanced feature engineering from raw packet data.
- `pcap_parser.py`: A script that processes all `.pcap` files in the `data/` directory, assigns activity labels, and creates a unified dataset for training.
- `train_model.py`: A script to train the advanced multi-input LSTM model.
- `realtime_predictor.py`: A script to predict congestion in real-time for a **specified activity**.
- `requirements.txt`: A list of all the Python dependencies.
- `activity_map.json`: A file that maps activity names to integer IDs (generated by `pcap_parser.py`).
- `congestion_model.keras`: The saved, trained model file.
- `scaler.gz`: The saved feature scaler.

## How to Use

### 1. Installation
```bash
pip install -r requirements.txt
```

### 2. Data Preparation & Training

The model's key feature is its ability to learn from different activity types.

1.  **Create a `data` Directory:** If it doesn't exist, create a directory named `data` in the project root.
2.  **Add Labeled `.pcap` Files:** Place your `.pcap` files inside the `data/` directory. Name them according to the activity they represent. The script uses the first part of the filename as the label.
    -   **Good examples:** `web_browsing_1.pcap`, `gaming_csgo.pcap`, `video.pcap`, `file_transfer.pcap`
    -   `web_browsing_1.pcap` and `web_browsing_2.pcap` will both be labeled as `web_browsing`.
    -   `gaming_csgo.pcap` and `game_valorant.pcap` will both be labeled as `gaming`.

3.  **Run the Parser:** Execute the parser script. It will process all files in the `data/` directory, create the `activity_map.json`, and generate the final `processed_data.csv`.
    ```bash
    python pcap_parser.py
    ```

4.  **Run the Training Script:** Now, train the new multi-input model.
    ```bash
    python train_model.py
    ```
    This will create the `congestion_model.keras` and `scaler.gz` files.

### 3. Real-Time Congestion Prediction

The real-time predictor now **requires you to specify the activity** so the model knows what context to apply.

1.  **Find Your Network Interface:** If you don't know your interface name, run the script with just your IP to see a list: `python realtime_predictor.py --ip YOUR_IP`

2.  **Run the Predictor with Activity:**
    ```bash
    # Example for predicting 'gaming' traffic
    # Note: Requires admin/sudo privileges
    sudo python realtime_predictor.py --ip 192.168.1.103 --iface wlan0 --activity gaming --bias-correction 0.005
    ```
    - Replace `YOUR_IP`, `wlan0`, and `gaming` with your specific configuration. The activity name must be one of the labels found during the parsing step (and present in `activity_map.json`).
    - The optional `--bias-correction` argument allows you to manually subtract a small constant value (e.g., 0.005 for 5ms) from the model's prediction to correct for any consistent positive bias.

The script will open a live plot and start predicting congestion, using the context you provided to make a more intelligent forecast.

---

## تشریح دقیق متدولوژی (نسخه پیشرفته)

این بخش متدولوژی پیشرفته مدل جدید را تشریح می‌کند.

### هدف: پیش‌بینی آگاه از زمینه (Context-Aware)

مدل جدید با افزودن یک ورودی برای **نوع فعالیت (Activity Type)**، از یک مدل صرفاً آماری به یک مدل آگاه از زمینه تبدیل شده است. این مدل یاد می‌گیرد که الگوهای ترافیکی نرمال برای فعالیت‌های مختلف (مانند وب‌گردی، بازی آنلاین، یا انتقال فایل) متفاوت هستند و پیش‌بینی خود را بر اساس این زمینه تنظیم می‌کند.

### مهندسی ویژگی‌های پیشرفته

ما به جای استفاده از داده‌های خام، ویژگی‌های هوشمندانه‌ای را مهندسی می‌کنیم که به مدل درک عمیق‌تری از وضعیت شبکه می‌دهند:
- **آمار RTT:** محاسبه `mean`, `min`, `max`, و `std` (انحراف معیار) RTT در هر بازه زمانی، به مدل اجازه می‌دهد تا پایداری و نوسان تاخیر را درک کند.
- **روند (Momentum):** محاسبه `diff()` یا تغییرات معیارهای کلیدی نسبت به بازه زمانی قبل (مانند `rtt_mean_trend`). این ویژگی به مدل کمک می‌کند تا تشخیص دهد که آیا شبکه در حال بهتر شدن است یا بدتر شدن.

### معماری مدل چند ورودی (Multi-input)

این مدل دارای دو مسیر ورودی است:
1.  **ورودی سری زمانی:** شامل ویژگی‌های مهندسی‌شده در یک دنباله زمانی (مثلاً ۱۰ بازه ۰.۵ ثانیه‌ای). این ورودی به لایه‌های LSTM داده می‌شود.
2.  **ورودی دسته‌بندی (Categorical):** شامل شناسه عددی نوع فعالیت (مثلاً ۰ برای `web_browsing`).

ورودی دسته‌بندی به یک **لایه Embedding** داده می‌شود. این لایه یک نمایش برداری چگال و یادگرفتنی برای هر نوع فعالیت ایجاد می‌کند. سپس، خروجی لایه‌های LSTM با خروجی لایه Embedding ترکیب (Concatenate) شده و به لایه‌های نهایی Dense برای تولید پیش‌بینی نهایی ارسال می‌شود. این معماری به مدل اجازه می‌دهد تا الگوهای زمانی را در زمینه نوع فعالیت تفسیر کند و دقت پیش‌بینی را به طور چشمگیری افزایش دهد.
